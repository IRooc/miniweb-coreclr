@inject MiniWeb.Core.IMiniWebSite MiniWebSite
@model MiniWeb.Core.ISitePage
@{
	var isPublished = Model.Visible;
	var path = Model.Url;
}

<nav id="miniweb-admin-nav" class="miniweb-tools" data-ispublished="@isPublished" data-miniweb-path="@path" data-miniweb-apiendpoint="@MiniWebSite.Configuration.ApiEndpoint">
	<div class="miniweb-tool miniweb-status @(isPublished ? " published" : "offline" )">
		<a href="#" id="reload-cache" class="navbar-brand">@(isPublished ? "" : "Offline")</a>
	</div>
	<div class="miniweb-tool pull-right">
		<ul class="miniweb-horizontal-list">
			<li class="hidden-xs"><input type="text" list="pages" id="miniwebNavigateOnEnter" /><datalist id="pages">
					@foreach (var p in MiniWebSite.Pages)
					{
						<option value="@(MiniWebSite.GetPageUrl(p))" />
					}
				</datalist></li>
			<li class="hidden-xs"><button onclick="document.querySelector('body').classList.add('preview')">Preview</button></li>
			<li id="miniwebShowHiddenPages"><label class="btn btn-link"><input type="checkbox" /><span class="hidden-xs">Show hidden pages</span></label></li>
			<li><button class="icon icon-new" id="miniwebButtonNew">New page</button></li>
			<li class="divider"></li>
			<li>
				<form action="@MiniWebSite.Configuration.Authentication.LogoutPath" method="post">
					<input type="hidden" name="returnUrl" value="@MiniWebSite.GetPageUrl(Model)" />
					<button type="submit" title="Signed in as @User.Identity.Name" class="icon icon-signout">Sign out</button>
				</form>
			</li>
		</ul>
	</div>
	<div class="miniweb-tool">
		<ul class="miniweb-horizontal-list">
			<li><button class="icon icon-props" id="miniwebPageProperties">Page properties</button></li>
			<li class="divider"></li>
			<li><button class="icon icon-edit" id="miniwebButtonEdit">Edit Content</button></li>
			<li><button class="icon icon-save" id="miniwebButtonSave" disabled>Save Content</button></li>
			<li><button class="icon icon-cancel" id="miniwebButtonCancel" disabled>Cancel</button></li>
		</ul>
	</div>

	<!--Html Tools-->
	<div id="tools">
		<div class="miniweb-buttongroup">
			<button data-edit="formatBlock <h1>">H1</button>
			<button data-edit="formatBlock <h2>">H2</button>
			<button data-edit="formatBlock <h3>">H3</button>
			<button data-edit="italic"><em>I</em></button>
			<button data-edit="bold"><strong>B</strong></button>
			<button data-edit="underline"><ins>U</ins></button>
			<button data-edit="strikethrough"><s>S</s></button>
		</div>

		<div class="miniweb-buttongroup">
			<button data-edit="justifyleft" title="Justify left" class="miniweb-leftalign">&#9778;</button>
			<button data-edit="justifycenter" title="Justify center">&#9778;</button>
			<button data-edit="justifyright" title="Justify right" class="miniweb-rightalign">&#9778;</button>
			<button data-edit="justifyfull" title="Justify full">&#9783;</button>
			<button data-edit="insertunorderedlist" title="Bullet points">&#9679;</button>
			<button data-edit="insertorderedlist" title="Numbered bullet points">&#9352;</button>
			<button data-edit="outdent" title="Indent left">&#11104;</button>
			<button data-edit="indent" title="Indent right">&#11106;</button>
		</div>

		<div class="miniweb-buttongroup">
			<button data-custom="createLink" title="Hyperlink" class="icon icon-earth"></button>
			<button data-edit="unlink" title="Remove hyperlink">&#11198;</button>
			<button data-custom="insertAsset">&#127203;</button>
		</div>

		<div class="miniweb-buttongroup">
			<button class="source" data-custom="showSource" title="Toggle source/design view">&#128065;</button>
		</div>
	</div>
	<input type="file" class="txtImage is-hidden" data-edit="insertImage"  />
</nav>
<aside class="is-hidden">
	<p class="alert"></p>
</aside>

<!-- Modal -->
<div class="mw-modal miniweb-pageproperties" id="miniweb-pageProperties" tabindex="-1" role="dialog" aria-labelledby="myModalPageLabel" aria-hidden="true">
	<div class="mw-modal-content">
		<div class="mw-modal-header">
			<h4 id="myModalPageLabel">Page properties</h4>
			<button class="icon right" data-dismiss=".mw-modal">&times;</button>
		</div>
		<form>
			<input type="hidden" name="NewPage" value="false" />
			<input type="hidden" name="OldUrl" value="@Model.Url" />
			<input type="hidden" name="Layout" value="@Model.Layout" />
			<div class="form-group">
				<label for="name">Page name</label>
				<input type="text" id="name" name="Title" placeholder="Page name" value="@Model.Title" />
			</div>
			<div class="form-group">
				<label for="metatitle">Browser title</label>
				<input type="text" id="metatitle" name="MetaTitle" placeholder="Browser title" value="@Model.MetaTitle" />
			</div>
			<div class="form-group">
				<label for="metadescription">Meta description</label>
				<textarea type="text" id="metadescription" name="MetaDescription" placeholder="Meta description" value="">@Model.MetaDescription</textarea>
			</div>
			<div class="form-group">
				<label for="template">Template</label>
				<select name="Template" id="template" data-curval="@Model.Template">
					@foreach (var s in MiniWebSite.PageTemplates)
					{
					<option value="@s" @(s.ToLowerInvariant()==Model.Template.ToLowerInvariant() ? "selected=\" selected\"" : "" )>@s.Substring(s.LastIndexOf("/") + 1)</option>
					}
				</select>
			</div>
			<div class="form-group">
				<label for="visible">Visible</label>
				<input type="checkbox" id="visible" name="Visible" @(Model.Visible ? "checked=\" checked\"" : "" ) value="true" />
			</div>
			<div class="form-group">
				<label for="ShowInMenu">Show in menu</label>
				<input type="checkbox" id="ShowInMenu" name="ShowInMenu" @(Model.ShowInMenu ? "checked=\" checked\"" : "" ) value="true" />
			</div>
			<div class="form-group">
				<label for="Sortorder"">Sortorder</label>
				<input type=" text" id="Sortorder" name="Sortorder" placeholder="Sortorder" value="@Model.SortOrder" />
			</div>
			<div class="form-group">
				<label for="url">Url</label>
				<div class="input-group">
					<span class="addon">/</span>
					<input type="text" id="url" name="Url" placeholder="url" value="@Model.Url" />
					<span class="addon">.@MiniWebSite.Configuration.PageExtension</span>
				</div>
			</div>
			<div class="form-group">
				<label for="url">RedirectUrl</label>
				<input type="text" id="url" name="RedirectUrl" placeholder="RedirectUrl" value="@Model.RedirectUrl" />
			</div>
		</form>
		<div class="mw-modal-footer">			
			<button data-dismiss=".mw-modal">Close</button>
			<button id="miniwebDeletePage">Delete Page</button>
			<button id="miniwebSavePage">Save properties</button>
		</div>
		<div class="is-hidden">
			<form>
				<label>force<input type="checkbox" name="force" value="true" /></label>
				<button type="button" id="add-multiplepages">Upload Pages</button>
				<input type="file" multiple name="files" style="position:absolute;width:0;height:0" />
			</form>
		</div>
	</div>
</div>

<div class="mw-modal" id="miniweb-addHyperLink" tabindex="-1" role="dialog" aria-labelledby="myModalHyperlinkLabel" aria-hidden="true">
	<div class="mw-modal-content">
		<div class="mw-modal-header">
			<h4 id="myModalHyperlinkLabel">Add hyperlink</h4>
			<button class="icon right" data-dismiss=".mw-modal">&times;</button>
		</div>
		<form>
			<div class="form-group">
				<label for="url" class="col-sm-4 control-label">Internal URL</label>
				<select name="InternalUrl">
					<option value="">Choose url or enter custom</option>
					@foreach (var p in MiniWebSite.Pages)
					{
					<option value="@(MiniWebSite.GetPageUrl(p))">/@p.Url (@p.Title)</option>
					}
				</select>
			</div>
			<div class="form-group">
				<label for="url" class="col-sm-4 control-label">Custom URL</label>
				<input type="text" name="Url" placeholder="custom url" value="https://" />
			</div>
		</form>
		<div class="mw-modal-footer">
			<button id="miniwebAddLink">Add link</button>
			<button data-dismiss=".mw-modal">Cancel</button>
		</div>
	</div>
</div>

<div class="mw-modal" id="newContentAdd" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="mw-modal-content">
		<div class="mw-modal-header">
			<h4 class="mw-modal-title" id="myModalLabel">Add content</h4>
			<button class="icon right" data-dismiss=".mw-modal">&times;</button>
		</div>
		<form>
			<p>Select an item to add</p>
			@foreach (var s in MiniWebSite.ItemTemplates)
			{
			<button data-add-content-id="content-@System.IO.Path.GetFileNameWithoutExtension(s)">@System.IO.Path.GetFileNameWithoutExtension(s) </button>
			}
		</form>
		<div class="mw-modal-footer">
			<button data-dismiss="mw-modal">Cancel</button>
		</div>
	</div>
</div>


<div class="mw-modal" id="miniweb-addAsset" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="mw-modal-content">
		<div class="mw-modal-header">
			<h4 class="mw-modal-title" id="myModalLabel">Add image</h4>
			<button class="icon right" data-dismiss=".mw-modal">&times;</button>
		</div>
		<form>
			<div class="mw-modal-body">
				<a href="#" id="miniweb-asset-page-left" class="miniweb-asset-pager" data-page-move="-1">&#10218;</a>
				<a href="#" id="miniweb-asset-page-right" class="miniweb-asset-pager" data-page-move="1">&#10219;</a>
				@{
					var allAssets = MiniWebSite.AssetStorage.GetAllAssets();
					var allFolders = allAssets.Select(a => a.Folder).Distinct().OrderBy(s => s).ToArray();
				}
				Folder: <input class="select-asset-folder" name="miniwebAssetFolder" list="miniweb-folder-list" value="@(allFolders.Any()? allFolders[0]:"")">
				<datalist id="miniweb-folder-list">
					@foreach(var f in allFolders)
					{
						<option value="@f">@f</option>
					}
				</datalist>

				<ul class="miniweb-assetlist" data-page="0" data-asset-root-path="images/">
					@foreach(var a in allAssets) 
					{
					<li data-path="@a.Folder" class="is-hidden">
						@if (a.Type == MiniWeb.Core.AssetType.Image) {
							<img data-src="@a.VirtualPath" data-filename="@a.FileName" data-relpath="@a.VirtualPath" class="miniweb-asset-pick" />
						}
						else
						{
							<span data-filename="@a.FileName" data-relpath="@a.VirtualPath" class="miniweb-asset-pick">@a.FileName</span>
						}
					</li>
					}
				</ul>
				<button id="miniweb-add-asset" type="button">Add Asset</button>
				<input type="file" multiple name="files" class="add-asset" style="position:absolute;width:0;height:0" />
			</div>
			<div class="mw-modal-footer">
				<button data-dismiss="mw-modal">Cancel</button>
			</div>
		</form>
	</div>
</div>

<div id="miniweb-templates">
	@foreach (var s in MiniWebSite.ItemTemplates)
	{
	<div id="content-@System.IO.Path.GetFileNameWithoutExtension(s)">
		@Html.Partial(s, MiniWebSite.DummyContent(s))
	</div>
	}
	@Html.AntiForgeryToken()
</div>

<link rel="stylesheet" href="/miniweb-resources/admin.css" />
<!-- <script src="/miniweb-resources/bootstrap-wysiwyg.js" defer></script> -->
<script src="/miniweb-resources/admin.js" type="module"></script>